from libposets.curve import Curve
from libposets.posets import *
import numpy as np


times = [0.0, 4.0, 8.0, 12.0, 16.0, 20.0, 24.0, 28.0, 32.0, 36.0, 40.0, 44.0, 48.0, 52.0, 56.0, 60.0, 64.0, 68.0, 72.0, 76.0, 80.0, 84.0, 88.0, 92.0, 96.0, 100.0, 104.0, 108.0, 112.0, 116.0, 120.0, 124.0, 128.0, 132.0, 136.0, 140.0, 144.0, 148.0, 152.0, 156.0, 160.0, 164.0, 168.0, 172.0, 176.0, 180.0, 184.0, 188.0, 192.0, 196.0]

data = np.asarray([[2.85, 79.04, 50.87, 32.95, 21.65, 14.52, 10.01, 7.15, 5.35, 4.21, 3.5, 3.05, 2.76, 2.59, 2.48, 2.39, 2.27, 2.16, 2.09, 2.04, 2.01, 2.0, 2.03, 2.11, 2.33, 3.0, 75.06, 48.28, 31.31, 20.61, 13.87, 9.6, 6.89, 5.18, 4.11, 3.43, 3.01, 2.74, 2.57, 2.47, 2.38, 2.25, 2.15, 2.08, 2.03, 2.01, 2.01, 2.03, 2.13, 2.37], [18.0, 434.11, 1431.49, 1579.93, 1570.39, 1519.12, 1474.24, 1443.22, 1423.15, 1410.45, 1402.45, 1397.28, 1392.93, 1383.26, 1340.44, 1199.38, 933.38, 629.04, 400.88, 251.94, 158.03, 99.38, 62.83, 40.08, 25.93, 17.14, 683.52, 1464.79, 1584.2, 1564.95, 1513.09, 1469.85, 1440.33, 1421.31, 1409.29, 1401.72, 1396.77, 1392.28, 1380.88, 1330.05, 1173.99, 895.68, 597.06, 379.39, 238.29, 149.49, 94.05, 59.52, 38.02, 24.65], [2.85, 1044.82, 1938.7, 2066.94, 1996.09, 1639.77, 956.7, 396.65, 140.02, 49.38, 19.46, 9.19, 5.3, 3.64, 2.85, 2.41, 2.0, 1.62, 1.37, 1.21, 1.12, 1.08, 1.09, 1.21, 1.6, 3.27, 1254.03, 1971.96, 2067.5, 1972.97, 1569.92, 874.21, 351.95, 123.32, 43.85, 17.61, 8.52, 5.03, 3.51, 2.78, 2.36, 1.95, 1.59, 1.34, 1.2, 1.11, 1.08, 1.1, 1.24, 1.69], [1.09, 36.92, 123.67, 183.85, 225.59, 254.53, 274.54, 287.31, 273.84, 203.85, 142.1, 98.73, 68.62, 47.73, 33.25, 23.21, 16.24, 11.41, 8.06, 5.73, 4.12, 3.0, 2.23, 1.69, 1.32, 1.06, 49.06, 132.09, 189.7, 229.64, 257.34, 276.47, 288.1, 267.36, 195.4, 136.05, 94.53, 65.7, 45.71, 31.85, 22.23, 15.57, 10.94, 7.73, 5.51, 3.97, 2.9, 2.15, 1.64, 1.28], [0.15, 45.75, 148.2, 155.55, 156.06, 156.1, 156.1, 156.1, 156.1, 156.1, 156.1, 156.05, 155.79, 154.25, 145.76, 111.6, 51.25, 14.2, 3.14, 0.73, 0.26, 0.17, 0.15, 0.15, 0.15, 0.15, 74.53, 150.36, 155.7, 156.08, 156.1, 156.1, 156.1, 156.1, 156.1, 156.09, 156.04, 155.72, 153.81, 143.54, 104.96, 44.93, 11.94, 2.62, 0.63, 0.24, 0.17, 0.15, 0.15, 0.15], [0.52, 2.69, 728.1, 1449.09, 1782.01, 1929.02, 1993.48, 2021.71, 2033.93, 2036.84, 2019.96, 1906.59, 1485.2, 853.35, 408.13, 182.59, 79.99, 34.92, 15.35, 6.89, 3.24, 1.67, 0.99, 0.7, 0.57, 0.52, 13.03, 842.37, 1504.49, 1806.62, 1939.82, 1998.21, 2023.78, 2034.76, 2036.39, 2014.45, 1876.89, 1411.43, 786.49, 371.56, 165.56, 72.45, 31.63, 13.93, 6.28, 2.98, 1.56, 0.94, 0.68, 0.56]])

def test1():
    eps = 0.05
    names = ["A","B","C","D","E","F"]
    curves = [Curve(data[k,:],times,True) for k in range(data.shape[0])]
    c = dict(zip(names,curves))
    solns = {
        "A" : [((0.0, 0.0), ('A', ' min')), ((4.0, 4.0), ('A', ' max')), ((28.0, 100.0), ('A', ' min')),((104.0, 104.0), ('A', ' max')), ((124.0, 196.0), ('A', ' min'))], "B" : [((0.0, 0.0), ('B', ' min')), ((8.0, 28.0), ('B', ' max')), ((80.0, 100.0), ('B', ' min')), ((108.0, 128.0), ('B', ' max')), ((180.0, 196.0), ('B', ' min'))], "C" : [((0.0, 0.0), ('C', ' min')), ((8.0, 16.0), ('C', ' max')), ((32.0, 100.0), ('C', ' min')), ((108.0, 116.0), ('C', ' max')), ((132.0, 196.0), ('C', ' min'))], "D" : [((0.0, 0.0), ('D', ' min')), ((24.0, 32.0), ('D', ' max')), ((60.0, 100.0), ('D', ' min')), ((124.0, 132.0), ('D', ' max')), ((160.0, 196.0), ('D', ' min'))], "E" : [((0.0, 0.0), ('E', ' min')), ((8.0, 56.0), ('E', ' max')), ((68.0, 100.0), ('E', ' min')), ((108.0, 156.0), ('E', ' max')), ((168.0, 196.0), ('E', ' min'))], "F" : [((0.0, 4.0), ('F', ' min')), ((20.0, 44.0), ('F', ' max')), ((60.0, 104.0), ('F', ' min')), ((120.0, 144.0), ('F', ' max')), ((160.0, 196.0), ('F', ' min'))]
    }

    for k in ["A","B","C","D","E","F"]:
        assert(get_mins_maxes(k,c[k],eps)[0] == solns[k])

    edges = set([
        (0,1),(0,2),(0,3),(0,4),(0,6),(0,7),(0,8),(0,9),
        (1,2),(1,3),(1,4),(1,6),(1,7),(1,8),(1,9),
        (2,3),(2,4),(2,8),(2,9),
        (3,4),(3,8),(3,9),
        (5,1),(5,2),(5,3),(5,4),(5,6),(5,7),(5,8),(5,9),
        (6,3),(6,4),(6,7),(6,8),(6,9),
        (7,8),(7,9),(7,3),(7,4),
        (8,9)
    ])

    ct = {"A" : c["A"], "B" : c["B"]}
    assert(eps_posets(ct, [eps])[0][1][1] == edges)
